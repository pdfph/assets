!function(e){var t=function(){var t,n,a,s,l=this,o=e(window).width(),r="",p={b:"text-bold",i:"text-italic",u:"text-underline",sub:"text-subscript",sup:"text-superscript",strike:"text-strikethrough",blockquote:"format-blockquote",a:"custom-link"},c=[],d=!1;l.settings={breakpoint:"700",heading_1_tag:"h1",heading_2_tag:"h2",heading_3_tag:"h3",heading_4_tag:"h4",heading_5_tag:"h5",heading_6_tag:"h6",controls:["bold","italics","underline","strikethrough","subscript","superscript","heading_1","heading_2","heading_3","heading_4","heading_5","heading_6"]},l.init=function(n,a){l.settings=e.extend(l.settings,a),t=n,$this_penplate_content=jQuery.trim(t.html()),($check_webplate=e(".webplate:first"))&&$check_webplate.length>0&&(d=!0),l.add_controls(),t.find("p:first").length<1&&t.html("<p>"+$this_penplate_content+"</p>"),t.attr({contenteditable:"true"}),document.execCommand("defaultParagraphSeparator",!1,"p"),p[l.settings.heading_1_tag]="format-"+l.settings.heading_1_tag,p[l.settings.heading_2_tag]="format-"+l.settings.heading_2_tag,p[l.settings.heading_3_tag]="format-"+l.settings.heading_3_tag,p[l.settings.heading_4_tag]="format-"+l.settings.heading_4_tag,p[l.settings.heading_5_tag]="format-"+l.settings.heading_5_tag,p[l.settings.heading_6_tag]="format-"+l.settings.heading_6_tag,l.window_type(),e(window).resize(function(){l.window_type()}),l.new_paragraph(),l.window_resize(),l.activate_controls(t),l.link_control()},l.add_controls=function(){a={bold:'<li><a href="#" class="textbtn noscript" data-pen-edit="text-bold"><i class="bi-type-bold"></i></a></li>',italics:'<li><a href="#" class="textbtn noscript" data-pen-edit="text-italic"><i class="bi-type-italic"></i></a></li>',underline:'<li><a href="#" class="textbtn noscript" data-pen-edit="text-underline"><i class="bi-type-underline"></i></a></li>',strikethrough:'<li><a href="#" class="textbtn noscript" data-pen-edit="text-strikethrough"><i class="bi-type-strikethrough"></i></a></li>',subscript:'<li><a href="#" class="textbtn script" data-pen-edit="text-subscript"><i class="bi-subscript"></i></a></li>',superscript:'<li><a href="#" class="textbtn script" data-pen-edit="text-superscript"><i class="bi-superscript"></i></a></li>',heading_1:'<li><a href="#" class="headerbtn" data-pen-edit="format-'+l.settings.heading_1_tag+'">H1</a></li>',heading_2:'<li><a href="#" class="headerbtn" data-pen-edit="format-'+l.settings.heading_2_tag+'">H2</a></li>',heading_3:'<li><a href="#" class="headerbtn" data-pen-edit="format-'+l.settings.heading_3_tag+'">H3</a></li>',heading_4:'<li><a href="#" class="headerbtn" data-pen-edit="format-'+l.settings.heading_4_tag+'">H4</a></li>',heading_5:'<li><a href="#" class="headerbtn" data-pen-edit="format-'+l.settings.heading_5_tag+'">H5</a></li>',heading_6:'<li><a href="#" class="headerbtn" data-pen-edit="format-'+l.settings.heading_6_tag+'">H6</a></li>'},r+='<div class="penplate-controls">',r+='<div class="penplate-link">',r+='<div class="input-container"><input type="text" value="" placeholder="Your link..." /></div>',r+='<a href="#" data-pen-edit="custom-link-cancel" class="link-cancel">Cancel</a>',r+="</div>",r+="<ul>",e.each(l.settings.controls,function(e,t){r+=a[t]}),r+="</ul></div>",0==e(".penplate-controls:first").length&&(e("body").append(r),0==d?e("body").append(r):e(".webplate .webplate-content").append(r),e(".penplate-controls:last").addClass("penplate-small"),e(".penplate-controls:first").addClass("penplate-large"),l.edit_selection())},l.window_type=function(){e(window).width()<=l.settings.breakpoint?(e("html").addClass("penplate-small-view"),e("html").removeClass("penplate-large-view"),n="small-view",l.reset_position()):(e("html").removeClass("penplate-small-view"),e("html").addClass("penplate-large-view"),n="large-view"),o=e(window).width()},l.reset_position=function(){e(".penplate-controls.penplate-large").css({top:"-100px",left:"0"})},l.activate_controls=function(t){t.on("mouseup",function(){l.check_selection()}),t.on("keyup",function(){l.check_selection()}),e("html").on("click",function(t){0==e(t.target).parents(".penplate-controls").length&&l.hide_controls(),e(window).resize(function(){l.hide_controls()})})},l.restore_selection=function(e){if(e)for($selection.removeAllRanges(),i=0,len=e.length;len>i;i+=1)$selection.addRange(e[i])},l.check_selection=function(){var t=window.getSelection().anchorNode.parentNode.tagName;for(("P"==t||"SPAN"==t)&&(e(".penplate-controls").find(".textbtn").show(),e(".penplate-controls").find(".headerbtn").hide()),-1!==t.indexOf("H")&&(e(".penplate-controls").find(".headerbtn").show(),e(".penplate-controls").find(".textbtn").hide()),$range_start=($range=($selection=window.getSelection()).getRangeAt(0)).startOffset,$range_end=$range.endOffset,$is_range=!1,$parent_node=null,c=[],$parent_node=l.get_parent_node($range);void 0!=$parent_node.tagName&&($tag_name=$parent_node.tagName.toLowerCase(),c.push($tag_name),"p"!=$tag_name)&&(e('.penplate-controls [data-pen-edit="'+p[$tag_name]+'"]').addClass("active"),$parent_node=$parent_node.parentNode,"h"!=$tag_name.substring(0,1)););l.save_selection(),$range_end-$range_start!=0&&($is_range=!0),1==$is_range&&l.show_controls()},l.save_selection=function(){if($selection){if(($selection=window.getSelection()).getRangeAt&&$selection.rangeCount){for(var e=[],t=0,n=$selection.rangeCount;n>t;++t)e.push($selection.getRangeAt(t));s=e}}else document.selection&&document.selection.createRange&&(s=document.selection.createRange())},l.range_check=function(e){var t=e.startContainer;return t===e.endContainer&&t.hasChildNodes()&&e.endOffset===e.startOffset+1},l.show_controls=function(){l.set_control_position(),0==e("html").hasClass("show-penplate-controls")&&e("html").addClass("show-penplate-controls"),e(".penplate-controls").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){1==e("html").hasClass("show-penplate-controls")&&e("html").addClass("penplate-controls-open")})},l.hide_controls=function(){e("html").hasClass("show-penplate-controls")&&e("html").hasClass("penplate-controls-open")&&(e("html").removeClass("show-penplate-controls").removeClass("penplate-controls-open"),e(".penplate-controls a.active").removeClass("active"),l.link_input_hide(),e(".penplate-controls.penplate-large").css({top:"-100px"}))},l.set_control_position=function(){"large-view"==n&&($control_w=e(".penplate-controls.penplate-large").outerWidth(),$control_h=e(".penplate-controls.penplate-large").height(),$offset_left=($boundary_center=(($boundary=($range=($selection=window.getSelection()).getRangeAt(0)).getBoundingClientRect()).left+$boundary.right)/2)-$control_w/2,$offset_top=0==d?$boundary.top+window.pageYOffset-($control_h+12):$boundary.top+e(".webplate .webplate-content").scrollTop()-($control_h+12),0>$offset_left?$offset_left=0:$offset_left+$control_w>o&&($offset_left=o-$control_w),e(".penplate-controls.penplate-large").css({left:$offset_left,top:$offset_top}))},l.edit_selection=function(){e(".penplate-controls a").on("click",function(t){$(this).hasClass("headerbtn")&&e(".penplate-controls a").removeClass("active"),$(this).hasClass("noscript")&&(e(".penplate-controls a.script.active").trigger("click"),e(".penplate-controls a.script").removeClass("active")),$(this).hasClass("script")&&(e(".penplate-controls a.script").removeClass("active"),e(".penplate-controls a.noscript.active").trigger("click")),t.preventDefault(),$pen_edit_type=($ex_pen_edit=($pen_edit=($this=e(this)).data("pen-edit")).split("-"))[0],$pen_edit_action=$ex_pen_edit[1],1==$this.hasClass("active")?$this.removeClass("active"):$this.addClass("active"),"text"==$pen_edit_type?document.execCommand($pen_edit_action):"format"==$pen_edit_type&&(($parent_tag_type=l.get_parent_tag_type())!=$pen_edit_action?($super_parent=window.getSelection().anchorNode.parentElement.parentElement.nodeName.toLowerCase(),"blockquote"==$pen_edit_action?(document.execCommand("outdent",!1,null),"blockquote"!=$super_parent&&document.execCommand("formatBlock",!1,$pen_edit_action)):document.execCommand("formatBlock",!1,$pen_edit_action)):document.execCommand("formatBlock",!1,"p")),l.save_selection(),setTimeout(function(){l.set_control_position()},1)}),e(".penplate-controls .penplate-link input").on("keyup",function(t){13===t.keyCode&&(t.preventDefault(),$link_input_val=e(this).val(),l.restore_selection(s),document.execCommand("createLink",!1,$link_input_val),$parent_type=1==($parent=e(this).parents(".penplate-controls")).hasClass("penplate-large")?"penplate-large":"penplate-small",l.link_input_hide($parent_type),e(".penplate-controls."+$parent_type+" a.img-link").addClass("active"),e(this).val(""))})},l.get_parent_node=function(e){return $parent_node=($check_range=l.range_check(e))?e.startContainer.childNodes[e.startOffset]:3===e.startContainer.nodeType?e.startContainer.parentNode:e.startContainer},l.get_parent_tag_type=function(){return($crt_selection=window.getSelection()).anchorNode.parentElement.nodeName.toLowerCase()},l.new_paragraph=function(){t.on("keypress",function(e){"13"==e.keyCode&&setTimeout(function(){document.execCommand("formatBlock",!1,"p")},10)})},l.window_resize=function(){e(window).on("resize",function(){l.window_type()})},l.link_control=function(){e(".penplate-controls a.img-link").on("click",function(){$is_link=!1,$parent_type=1==($parent=e(this).parents(".penplate-controls")).hasClass("penplate-large")?"penplate-large":"penplate-small",e.each(c,function(e,t){"a"==t&&($is_link=!0)}),1==$is_link?(document.execCommand("unlink",!1,null),l.remove_current_node("a"),l.save_selection()):l.link_input_show($parent_type)}),e(".penplate-controls .link-cancel").on("click",function(t){t.preventDefault(),$parent_type=1==($parent=e(this).parents(".penplate-controls")).hasClass("penplate-large")?"penplate-large":"penplate-small",l.link_input_hide($parent_type),l.restore_selection(s)})},l.remove_current_node=function(e){($node_index=c.indexOf(e))>-1&&c.splice($node_index,1)},l.link_input_show=function(t){console.log(t),e(".penplate-controls."+t+" ul").hide(),e(".penplate-controls."+t+" .penplate-link").fadeIn("fast",function(){e(".penplate-controls."+t+" .penplate-link input").focus()})},l.link_input_hide=function(t){e(".penplate-controls."+t+" ul").fadeIn(),e(".penplate-controls."+t+" .penplate-link").hide(),e(".penplate-controls."+t+" a.img-link").removeClass("active")}};e.fn.penplate=function(n){var a=this.length;return this.each(function(s){var l=e(this),o="penplate"+(a>1?"-"+ ++s:""),r=(new t).init(l,n);l.data(o,r).data("key",o)})}}(jQuery);